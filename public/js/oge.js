var OGE={version:0.8};OGE.merge=function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c];return a};if(typeof module!=="undefined"&&module.exports)module.exports=OGE;OGE.Direction=function(a,b){this.cos=typeof a!="undefined"?a:0;this.sin=typeof b!="undefined"?b:0};OGE.Direction.prototype.rotate=function(a){a=a*(Math.PI/180);this.cos=Math.cos(Math.acos(this.cos)+a);this.sin=Math.sin(Math.asin(this.sin)+a);return this};OGE.Direction.prototype.clone=function(){return OGE.Direction.deserialize(this.serialize())};
OGE.Direction.prototype.serialize=function(){return OGE.merge({},this)};OGE.Direction.deserialize=function(a){var b=new OGE.Direction(a.cos,a.sin);return OGE.merge(b,a)};OGE.Zone=function(a,b){this.x=typeof a!="undefined"?a:0;this.y=typeof b!="undefined"?b:0;this.bodies=[]};OGE.Zone.prototype.addBody=function(a){for(var b=0;b<this.bodies.length;b++)if(this.bodies[b]===a)return;this.bodies.push(a)};
OGE.Zone.prototype.removeBody=function(a){for(var b=0;b<this.bodies.length;b++)if(this.bodies[b]===a){this.bodies.splice(b,1);break}};OGE.Body=function(a,b,c,d){this.x=typeof a!="undefined"?a:0;this.y=typeof b!="undefined"?b:0;this.width=typeof c!="undefined"?c:1;this.height=typeof d!="undefined"?d:1;this.speed=0;this.direction=null;this.active=this.slide=false;this.onCollisions=[]};OGE.Body.prototype.clearEvents=function(){this.onCollisions=[]};OGE.Body.prototype.onCollision=function(a){this.onCollisions.push(a)};
OGE.Body.prototype.collide=function(a){for(var b=true,c=0;c<this.onCollisions.length;c++)if(this.onCollisions[c](a)===false)b=false;return b};OGE.Body.prototype.collide=function(a){for(var b=true,c=0;c<this.onCollisions.length;c++)if(this.onCollisions[c](a)===false)b=false;return b};OGE.Body.prototype.intersects=function(a,b,c,d){var e;e=a;if(arguments.length===1){e=a.x;b=a.y;c=a.width;d=a.height}return this.x<e+c&&this.x+this.width>e&&this.y<b+d&&this.y+this.height>b};
OGE.Body.prototype.intersection=function(a,b,c,d){var e;e=a;if(arguments.length===1){e=a.x;b=a.y;c=a.width;d=a.height}return((this.x+this.width<e+c?this.x+this.width:e+c)-(this.x>e?this.x:e))*((this.y+this.height<b+d?this.y+this.width:b+d)-(this.y>b?this.y:b))};
OGE.World=function(a,b,c){this.width=typeof a!="undefined"?a:640;this.height=typeof b!="undefined"?b:480;this.zoneSize=typeof c!="undefined"?c:10;this.activeBodies=[];a=a/this.zoneSize+1<<0;b=b/this.zoneSize+1<<0;this.zones=[];for(c=0;c<a;c++){this.zones[c]=[];for(var d=0;d<b;d++)this.zones[c][d]=new OGE.Zone(c,d)}};OGE.World.prototype.addBody=function(a,b){if(this.addBodyToZones(a)!==true)return false;if(arguments.length>=2)a.active=b;a.active&&this.activeBodies.push(a);return true};
OGE.World.prototype.removeBody=function(a){this.removeBodyFromZones(a);for(var b=0;b<this.activeBodies.length;b++)if(this.activeBodies[b]===a){this.activeBodies.splice(b,1);break}};
OGE.World.prototype.getBodies=function(a,b,c,d){var e,f;e=f=a;if(arguments.length===1){f=e.x;b=e.y;c=e.width;d=e.height}f=f<0?0:f;f=f+c>this.width?this.width-c:f;b=b<0?0:b;b=b+d>this.height?this.height-d:b;e=[];f=this.getZones(f,b,c,d);for(var j=0;j<f.length;j++)for(var i=f[j].bodies,g=0;g<i.length;g++){for(var h=i[g],l=false,k=0;k<e.length;k++)if(e[k]===h){l=true;break}l||e.push(h)}return e};
OGE.World.prototype.getZones=function(a,b,c,d){var e,f;e=f=a;if(arguments.length===1){f=e.x;b=e.y;c=e.width;d=e.height}if(f>=0&&f+c-1<this.width&&b>=0&&b+d-1<this.height){e=(f+c)/this.zoneSize<<0;var j=b/this.zoneSize<<0,i=(b+d)/this.zoneSize<<0,g=0,h=[];for(f=f/this.zoneSize<<0;f<=e;f++)for(b=j;b<=i;b++)h[g++]=this.zones[f][b];return h}else return[]};
OGE.World.prototype.step=function(a){a=arguments.length===0?1:a;for(var b=0;b<a;b++)for(var c=0;c<this.activeBodies.length;c++){var d=this.activeBodies[c];d.speed>0&&d.direction!==null&&this.moveBody(d)}};OGE.World.prototype.addBodyToZones=function(a){var b=this.getZones(a);if(b.length===0)return false;for(var c=0;c<b.length;c++)b[c].addBody(a);return true};OGE.World.prototype.removeBodyFromZones=function(a){for(var b=this.getZones(a),c=0;c<b.length;c++)b[c].removeBody(a)};
OGE.World.prototype.moveBody=function(a,b,c){var d,e,f;if(arguments.length===1){b=a.direction;c=a.speed}for(var j=0;j<c;j++){d=a.x;e=a.y;this.removeBodyFromZones(a);a.x+=b.cos;a.y+=b.sin;if(a.x<0||a.x+a.width>this.width||a.y<0||a.y+a.height>this.height){a.x=a.x<0?0:a.x;a.x=a.x+a.width>this.width?this.width-a.width:a.x;a.y=a.y<0?0:a.y;a.y=a.y+a.height>this.height?this.height-a.height:a.y;a.collide(this)}f=this.getBodies(a);for(var i=0;i<f.length;i++){var g=f[i];if(a!==g&&!g.intersects(d,e,a.width,
a.height)&&g.intersects(a)){var h=a.collide(g)===true;g=g.collide(a)===true;if(h&&g){a.x=d;a.y=e;this.addBodyToZones(a);if(a.slide&&i>=0)this.slideBody(a,b);else return}}}this.addBodyToZones(a)}};
OGE.World.prototype.slideBody=function(a,b){var c=this,d=function(f){var j=[],i=c.getBodies(a),g,h,l,k,m,n;for(h=0;h<i.length;h++){m=i[h];m!==a&&m.intersects(a)&&j.push(m)}g=0;l=a.x+f.cos*1.9<<0;if(l!==a.x)l=a.x+(l>a.x?1:-1);k=a.y+f.sin*1.9<<0;if(k!==a.y)k=a.y+(k>a.y?1:-1);i=c.getBodies(l,k,a.width,a.height);for(h=0;h<i.length;h++){m=i[h];if(m!==a&&m.intersects(l,k,a.width,a.height)){n=false;for(f=0;f<j.length;f++)if(m===j[f]){n=true;break}n||(g+=m.intersection(l,k,a.width,a.height))}}return g<<0},
e=d(b.clone().rotate(-45));d=d(b.clone().rotate(45));if(e<d)this.moveBody(a,b.clone().rotate(-90),1);else e>d&&this.moveBody(a,b.clone().rotate(90),1)};
